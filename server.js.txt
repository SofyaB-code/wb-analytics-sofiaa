import express from "express";
import fetch from "node-fetch";
import cors from "cors";

const app = express();
app.use(cors());
app.use(express.json());

// ðŸ”’ Ð¢Ð²Ð¾Ð¹ Ñ‚Ð¾ÐºÐµÐ½ WB
const API_TOKEN = "eyJhbGciOiJFUzI1NiIsImtpZCI6IjIwMjUwOTA0djEiLCJ0eXAiOiJKV1QifQ.eyJhY2MiOjEsImVudCI6MSwiZXhwIjoxNzc3NzgwOTMwLCJpZCI6IjAxOWE0MDI3LTlmZDQtN2I4ZS1hNzIzLWYyNjNkNWY4ZDAwYiIsImlpZCI6MjAxNTQ2MTksIm9pZCI6MjgyNzg0LCJzIjoxNjEyNiwic2lkIjoiNzZlZmM0NjktYTgxNS00NGEyLWIzMjEtNzMzNzI5ZjY0NjBlIiwidCI6ZmFsc2UsInVpZCI6MjAxNTQ2MTl9.kkC7tOSVAMfjqHW_Nb7G1xrcusbD7ijizu-I50sgHoRGf9I5QydxePFZ48siQwKn9fBhZwdDQPJYcRyAwfPTjw";

const HEADERS = { Authorization: API_TOKEN };
const BASE_URL = "https://statistics-api.wildberries.ru/api/v1/supplier";

// ðŸ”¹ Ð Ð¾ÑƒÑ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð¶
app.get("/api/sales", async (req, res) => {
  const dateFrom = req.query.dateFrom || "2024-10-01";
  const dateTo = req.query.dateTo || "2024-10-31";

  const url = ${BASE_URL}/reportDetailByPeriod?dateFrom=${dateFrom}&dateTo=${dateTo}&limit=1000;

  try {
    const response = await fetch(url, { headers: HEADERS });
    const data = await response.json();
    res.json(data);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ Ðº WB API" });
  }
});

// ðŸ”¹ Ð Ð¾ÑƒÑ‚ Ð´Ð»Ñ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¾Ð²
app.get("/api/stocks", async (req, res) => {
  const url = ${BASE_URL}/stocks;
  try {
    const response = await fetch(url, { headers: HEADERS });
    const data = await response.json();
    res.json(data);
  } catch (err) {
    res.status(500).json({ error: "ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ð¸ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¾Ð²" });
  }
});

app.listen(3000, () => console.log("âœ… Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 3000"));